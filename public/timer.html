<html>
<script>
const url = "https://uswork.today/api/cow";
const timerLength = 25*1000*60;
var timeElapsed;
var startTime;
var endTime;


function reqListener () {
 // document.getElementById("date").innerHTML = this.responseText;
  endTime = parseInt(this.responseText) + timerLength;
	//console.log(this.responseText);
clearTimeout(tick); 
 setTimeout(tick, 1000);
}

function getTime() {
  var oReq = new XMLHttpRequest();
  oReq.addEventListener("load", reqListener);
  oReq.open("GET", url);
  oReq.send();
}

function postTime() {
  var http = new XMLHttpRequest();
  var params = '';
  http.open('POST', url, true);
  //Send the proper header information along with the request
  http.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');

  http.onreadystatechange = function() {//Call a function when the state changes.
          //endTime = Date.now() + timerLength;
    //setTimeout(tick, 1);
	getTime();  
}
  http.send(params);
}

function timeRemaining(){
  //return Math.floor((endTime-Date.now())/1000);
  return (endTime-Date.now());
}

window.addEventListener("load", function(event) {

  //setTimeout(getTime, 500);

  document.getElementById("start").addEventListener("click", function(){
    postTime();
    
  });

  document.getElementById("update").addEventListener("click", function(){
    getTime();
  });
});

function tick() {
document.getElementById("date").innerHTML = endTime+" " +Date.now();
  document.getElementById("time").innerHTML = timeRemaining();
clearTimeout(tick);  
setTimeout(tick, 1);
}
</script>
<body>
	<p id="date"></p>
    <p id="time"></p>

	<button id="start">Start</button>
  <button id="update">Update</button>
</body>
</html>
